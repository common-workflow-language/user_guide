
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Running Tools Inside Docker &#8212; Common Workflow Language User Guide 0.1 documentation</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Additional Arguments and Parameters" href="../08-arguments/index.html" />
    <link rel="prev" title="Parameter References" href="../06-params/index.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    
      
      <link rel="icon" sizes="16x16" href="../_static/images/favicons/cwl/favicon-16x16.png">
      
    
      
      <link rel="icon" sizes="32x32" href="../_static/images/favicons/cwl/favicon-32x32.png">
      
    
      
      <link rel="icon" sizes="96x96" href="../_static/images/favicons/cwl/favicon-96x96.png">
      
    
      
      <link rel="icon" sizes="128x128" href="../_static/images/favicons/cwl/favicon-128.png">
      
    
      
      <link rel="icon" sizes="196x196" href="../_static/images/favicons/cwl/favicon-196x196.png">
      
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
    
    <div class="container-fluid" id="banner"></div>

    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    

<a class="navbar-brand" href="../index.html">
  <img src="../_static/CWL-Logo-HD-cropped2.png" class="logo" alt="logo">
</a>


    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../CODE_OF_CONDUCT.html">
  Code of Conduct
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../setup.html">
  Setup
 </a>
</li>

<li class="toctree-l1 current active nav-item">
 <a class="reference internal nav-link" href="../episodes.html">
  Episodes
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../extras.html">
  Extras
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../LICENSE.html">
  Licenses
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/common-workflow-language/user_guide/" rel="noopener" target="_blank" title="GitHub"><span><i class="fab fa-github-square"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar">
              <div class="sidebar-start-items"><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links d-none d-md-block" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    <ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../01-introduction/index.html">
   Introduction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../02-1st-example/index.html">
   First Example
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../03-input/index.html">
   Essential Input Parameters
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../04-output/index.html">
   Returning Output Files
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../05-stdout/index.html">
   Capturing Standard Output
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../06-params/index.html">
   Parameter References
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Running Tools Inside Docker
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../08-arguments/index.html">
   Additional Arguments and Parameters
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../09-array-inputs/index.html">
   Array Inputs
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../10-array-outputs/index.html">
   Array Outputs
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../11-records/index.html">
   Advanced Inputs
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../12-env/index.html">
   Environment Variables
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../13-expressions/index.html">
   JavaScript Expressions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../14-runtime/index.html">
   Creating Files at Runtime
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../15-staging/index.html">
   Staging Input Files
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../16-file-formats/index.html">
   File Formats
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../17-metadata/index.html">
   Metadata and Authorship
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../19-custom-types/index.html">
   Custom Types
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../20-software-requirements/index.html">
   Specifying Software Requirements
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../21-1st-workflow/index.html">
   Writing Workflows
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../22-nested-workflows/index.html">
   Nested Workflows
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../23-scatter-workflow/index.html">
   Scattering Workflows
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../24_conditional-workflow/index.html">
   Conditional workflows
  </a>
 </li>
</ul>

  </div>
</nav>
              </div>
              <div class="sidebar-end-items">
              </div>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
              
              <div class="toc-item">
                

<nav id="bd-toc-nav">
    
</nav>
              </div>
              
              <div class="toc-item">
                

<div class="tocsection editthispage">
    <a href="https://github.com/common-workflow-language/user_guide/edit/gh-pages/07-containers/index.md">
        <i class="fas fa-pencil-alt"></i> Edit this page
    </a>
</div>

              </div>
              
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <section id="running-tools-inside-docker">
<h1>Running Tools Inside Docker<a class="headerlink" href="#running-tools-inside-docker" title="Permalink to this headline">#</a></h1>
<p><a class="reference external" href="https://docker.io">Docker</a> containers simplify software installation by providing a
complete known-good runtime for software and its dependencies.  However,
containers are also purposefully isolated from the host system, so in
order to run a tool inside a Docker container there is additional work to
ensure that input files are available inside the container and output
files can be recovered from the container.  A CWL runner can perform this work
automatically, allowing you to use Docker to simplify your software
management while avoiding the complexity of invoking and managing Docker
containers.</p>
<p>One of the responsibilities of the CWL runner is to adjust the paths of
input files to reflect the location where they appear inside the container.</p>
<p>This example runs a simple Node.js script inside a Docker container which will
then print “Hello World” to the standard output.</p>
<p><em>docker.cwl</em></p>
<div class="highlight-cwl notranslate"><div class="highlight"><pre><span></span><span class="c1">#!/usr/bin/env cwl-runner</span><span class="w"></span>

<span class="nt">cwlVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1.0</span><span class="w"></span>
<span class="nt">class</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CommandLineTool</span><span class="w"></span>
<span class="nt">baseCommand</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">node</span><span class="w"></span>
<span class="nt">hints</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">DockerRequirement</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">dockerPull</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">node:slim</span><span class="w"></span>
<span class="nt">inputs</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">src</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">File</span><span class="w"></span>
<span class="w">    </span><span class="nt">inputBinding</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">position</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span><span class="w"></span>
<span class="nt">outputs</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">example_out</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">stdout</span><span class="w"></span>
<span class="nt">stdout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">output.txt</span><span class="w"></span>
</pre></div>
</div>
<p><em>docker-job.yml</em></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">src</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">class</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">File</span><span class="w"></span>
<span class="w">  </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hello.js</span><span class="w"></span>
</pre></div>
</div>
<p>Before we run this, lets just break it down and see what some bits do.  Most of this
has been explained in previous sections, the only part that is really new is the <code class="docutils literal notranslate"><span class="pre">dockerRequirement</span></code>
section.</p>
<div class="highlight-cwl notranslate"><div class="highlight"><pre><span></span><span class="nt">baseCommand</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">node</span><span class="w"></span>
<span class="nt">hints</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">DockerRequirement</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">dockerPull</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">node:slim</span><span class="w"></span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">baseCommand:</span> <span class="pre">node</span></code> tells CWL that we will be running this command in a container. We
then need to specify some <code class="docutils literal notranslate"><span class="pre">hints</span></code> for how to find the container we want.  In this case we list
just our requirements for the docker container in <code class="docutils literal notranslate"><span class="pre">DockerRequirements</span></code>.  The <code class="docutils literal notranslate"><span class="pre">dockerPull:</span></code>
parameter takes the same value that you would pass to a <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">pull</span></code> command. That is,
the name of the container image (you can even specify the tag, which is good idea for
best practises when using containers for reproducible research). In this case we have
used a container called <code class="docutils literal notranslate"><span class="pre">node:slim</span></code>.</p>
<p>Provide a “hello.js” and invoke <code class="docutils literal notranslate"><span class="pre">cwl-runner</span></code> providing the tool wrapper and the
input object on the command line:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ <span class="nb">echo</span> <span class="s2">&quot;console.log(\&quot;Hello World\&quot;);&quot;</span> &gt; hello.js
$ cwl-runner docker.cwl docker-job.yml
<span class="o">[</span>job docker.cwl<span class="o">]</span> /tmp/tmpgugLND$ docker <span class="se">\</span>
    run <span class="se">\</span>
    -i <span class="se">\</span>
    --volume<span class="o">=</span>/tmp/tmpgugLND:/var/spool/cwl:rw <span class="se">\</span>
    --volume<span class="o">=</span>/tmp/tmpSs5JoN:/tmp:rw <span class="se">\</span>
    --volume<span class="o">=</span>/home/me/cwl/user_guide/hello.js:/var/lib/cwl/job369354770_examples/hello.js:ro <span class="se">\</span>
    --workdir<span class="o">=</span>/var/spool/cwl <span class="se">\</span>
    --read-only<span class="o">=</span><span class="nb">true</span> <span class="se">\</span>
    --user<span class="o">=</span><span class="m">1000</span> <span class="se">\</span>
    --rm <span class="se">\</span>
    --env<span class="o">=</span><span class="nv">TMPDIR</span><span class="o">=</span>/tmp <span class="se">\</span>
    --env<span class="o">=</span><span class="nv">HOME</span><span class="o">=</span>/var/spool/cwl <span class="se">\</span>
    node:slim <span class="se">\</span>
    node <span class="se">\</span>
    /var/lib/cwl/job369354770_examples/hello.js &gt; /tmp/tmpgugLND/output.txt
<span class="o">[</span>job docker.cwl<span class="o">]</span> completed success
<span class="o">{</span>
    <span class="s2">&quot;example_out&quot;</span>: <span class="o">{</span>
        <span class="s2">&quot;location&quot;</span>: <span class="s2">&quot;file:///home/me/cwl/user_guide/output.txt&quot;</span>,
        <span class="s2">&quot;basename&quot;</span>: <span class="s2">&quot;output.txt&quot;</span>,
        <span class="s2">&quot;class&quot;</span>: <span class="s2">&quot;File&quot;</span>,
        <span class="s2">&quot;checksum&quot;</span>: <span class="s2">&quot;sha1</span><span class="nv">$648</span><span class="s2">a6a6ffffdaa0badb23b8baf90b6168dd16b3a&quot;</span>,
        <span class="s2">&quot;size&quot;</span>: <span class="m">12</span>,
        <span class="s2">&quot;path&quot;</span>: <span class="s2">&quot;/home/me/cwl/user_guide/output.txt&quot;</span>
    <span class="o">}</span>
<span class="o">}</span>
Final process status is success
$ cat output.txt
Hello World
</pre></div>
</div>
<p>Notice the CWL runner has constructed a Docker command line to run the
script.</p>
<p>In this example, the path to the script <code class="docutils literal notranslate"><span class="pre">hello.js</span></code> is <code class="docutils literal notranslate"><span class="pre">/home/me/cwl/user_guide/hello.js</span></code>
outside the container but <code class="docutils literal notranslate"><span class="pre">/var/lib/cwl/job369354770_examples/hello.js</span></code> inside
the container, as reflected in the invocation of the <code class="docutils literal notranslate"><span class="pre">node</span></code> command.</p>
</section>


              </div>
              
              
              <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="../06-params/index.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Parameter References</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="../08-arguments/index.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Additional Arguments and Parameters</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
              
          </main>
          

      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>

<div class="container">
  <div class="row">
    <div class="col d-flex flex-row-reverse">
      <ul class="nav">
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/common-workflow-language/user_guide/blob/gh-pages/CONTRIBUTING.md">Contributing</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/common-workflow-language/user_guide/">Source</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/common-workflow-language/user_guide/blob/gh-pages/CITATION">Cite</a>
        </li>
      </ul>
    </div>
  </div>
</div>

<footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright 2013, CWL Project Team.<br>
</p>
    </div>
    
  </div>
</footer>

  </body>
</html>